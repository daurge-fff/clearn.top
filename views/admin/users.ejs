<div class="container">
    <div class="page-header">
        <h1>User Management</h1>
        <div class="page-actions">
            <a href="#" id="export-btn" class="btn btn-secondary"><i class="icon-export"></i> Export to CSV</a>
            <a href="/dashboard/users/add" class="btn btn-primary"><i class="icon-add"></i> Add User</a>
        </div>
    </div>

    <div class="card filter-card">
        <form action="/dashboard/users" method="GET" class="filter-form">
            <div class="filter-group">
                <label for="role">Filter by Role</label>
                <select name="role" id="role">
                    <option value="">All Roles</option>
                    <option value="student" <%= (query && query.role === 'student') ? 'selected' : '' %>>Student</option>
                    <option value="teacher" <%= (query && query.role === 'teacher') ? 'selected' : '' %>>Teacher</option>
                    <option value="admin" <%= (query && query.role === 'admin') ? 'selected' : '' %>>Admin</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="status">Filter by Status</label>
                <select name="status" id="status">
                    <option value="">All Statuses</option>
                    <option value="active" <%= (query && query.status === 'active') ? 'selected' : '' %>>Active</option>
                    <option value="inactive" <%= (query && query.status === 'inactive') ? 'selected' : '' %>>Inactive</option>
                    <option value="paused" <%= (query && query.status === 'paused') ? 'selected' : '' %>>Paused</option>
                </select>
            </div>
            <div class="filter-actions">
                <button type="submit" class="btn btn-primary">Apply</button>
                <a href="/dashboard/users" class="btn btn-secondary">Clear</a>
            </div>
        </form>
    </div>

    <div class="card">
        <% if (users && users.length > 0) { %>
            <div class="table-responsive">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Lessons Paid</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% users.forEach(u => { %>
                            <tr>
                                <td><%= u.name %></td>
                                <td><%= u.email %></td>
                                <td><span class="badge role-<%= u.role %>"><%= u.role %></span></td>
                                <td><span class="badge status-<%= u.status %>"><%= u.status %></span></td>
                                <td><%= u.role === 'student' ? u.lessonsPaid : 'N/A' %></td>
                                <td class="actions-cell">
                                    <a href="/dashboard/users/edit/<%= u._id %>" class="btn-icon" data-tooltip="Edit"><i class="icon-edit"></i></a>
                                    <a href="/dashboard/users/delete/<%= u._id %>" class="btn-icon btn-danger" data-tooltip="Delete" onclick="return confirm('Are you sure?')"><i class="icon-delete"></i></a>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
        <% } else { %>
            <div class="empty-state">
                <div class="empty-state-icon"><i class="icon-users"></i></div>
                <h3>No Users Found</h3>
                <p>No users match your current filter criteria. Try clearing the filters.</p>
                <a href="/dashboard/users" class="btn btn-secondary">Clear Filters</a>
            </div>
        <% } %>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const exportBtn = document.getElementById('export-btn');
    
    function updateExportLink() {
        const role = document.getElementById('role').value;
        const status = document.getElementById('status').value;
        
        const params = new URLSearchParams();
        if (role) params.append('role', role);
        if (status) params.append('status', status);
        
        exportBtn.href = `/api/users/export?${params.toString()}`;
    }

    updateExportLink();

    document.getElementById('role').addEventListener('change', updateExportLink);
    document.getElementById('status').addEventListener('change', updateExportLink);
});
</script>